<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkyWallet - Apne Paiso Ko Kaam Par Lagaye</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #0b0f19; --glass: rgba(255, 255, 255, 0.05);
            --primary: #4f46e5; --accent: #22d3ee; --text: #f8fafc;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Inter', system-ui, sans-serif; background: var(--bg); 
            color: var(--text); margin: 0; min-height: 100vh;
        }
        .hidden { display: none !important; }

        /* Login Screen */
        #loginSection {
            height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
            background: radial-gradient(circle at top right, #1e1b4b, #0b0f19);
            padding: 20px;
        }
        .logo-box { font-size: 3.5rem; font-weight: 900; background: linear-gradient(to bottom, #fff, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .tagline { font-size: 1.1rem; color: #94a3b8; margin: 10px 0 40px; }
        .login-card { background: var(--glass); backdrop-filter: blur(20px); padding: 40px 20px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 350px; }
        
        .btn-google { 
            background: white; color: black; border-radius: 15px; border: none;
            padding: 15px; font-weight: bold; width: 100%; display: flex;
            align-items: center; justify-content: center; gap: 10px; cursor: pointer;
        }

        /* Dashboard */
        .container { max-width: 480px; margin: auto; padding: 15px; }
        .wallet-card { background: linear-gradient(135deg, #4f46e5, #9333ea); padding: 30px 20px; border-radius: 25px; text-align: center; margin-top: 20px; }
        .glass-card { background: var(--glass); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.08); margin-top: 20px; }
        .btn-action { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>

<div id="loginSection">
    <div class="logo-box">SkyWallet</div>
    <div class="tagline">Apne paiso ko kaam par lagaye</div>
    <div class="login-card">
        <p style="margin-bottom:20px; opacity: 0.8;">Surakshit investment ki shuruat karein</p>
        <button class="btn-google" onclick="login()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/pwa_google_symbol.svg" width="22" alt="G">
            Google se Login karein
        </button>
    </div>
</div>

<div id="appSection" class="container hidden">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 id="uName">User</h3>
        <button onclick="logout()" style="color:#f43f5e; background:none; border:none; font-weight:bold;">Logout</button>
    </div>

    <div class="wallet-card">
        <p style="font-size: 0.8rem; opacity: 0.8;">BALANCE</p>
        <h1 id="balanceDisplay" style="font-size: 3rem; margin: 0;">₹0</h1>
    </div>

    <div class="glass-card">
        <h4 style="margin-top:0;">Deposit & Withdraw</h4>
        <div style="display:flex; gap:10px;">
            <button class="btn-action" onclick="reqTx('Deposit')">Deposit</button>
            <button class="btn-action" onclick="reqTx('Withdraw')" style="background:rgba(255,255,255,0.1)">Withdraw</button>
        </div>
    </div>

    <div id="adminPanel" class="glass-card hidden" style="border-color: #f43f5e;">
        <h4 style="color:#f43f5e;">Admin Dashboard</h4>
        <div id="adminRequests">Loading...</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB08YgLPpftxwvlKQQ9D4dRCEn4QXk-fks",
        authDomain: "investamount-2d60a.firebaseapp.com",
        projectId: "investamount-2d60a",
        storageBucket: "investamount-2d60a.firebasestorage.app",
        messagingSenderId: "1680550862",
        appId: "1:1680550862:web:5218a3fc4c1ba814cc599f",
        measurementId: "G-FSZHVME0YB"
    };

    const adminEmail = "onlinetechcenter786@gmail.com";
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Login Fix for Mobile Loop
    function login() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithRedirect(provider);
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    // Handle Auth Result
    auth.getRedirectResult().then(res => {
        if(res.user) console.log("User logged in via redirect");
    }).catch(err => alert("Login Error: " + err.message));

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('appSection').classList.remove('hidden');
            document.getElementById('uName').innerText = user.displayName;
            loadUserData(user);
            if(user.email.toLowerCase() === adminEmail.toLowerCase()) {
                document.getElementById('adminPanel').classList.remove('hidden');
                loadAdminData();
            }
        } else {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
        }
    });

    function loadUserData(user) {
        db.collection('users').doc(user.uid).onSnapshot(doc => {
            if(!doc.exists()) {
                db.collection('users').doc(user.uid).set({ balance: 0, email: user.email });
            } else {
                document.getElementById('balanceDisplay').innerText = `₹${doc.data().balance}`;
            }
        });
    }

    async function reqTx(type) {
        let amt = prompt(`${type} amount?`);
        if(!amt || isNaN(amt)) return;
        await db.collection('requests').add({
            uid: auth.currentUser.uid,
            email: auth.currentUser.email,
            amount: parseInt(amt),
            type: type,
            status: 'pending',
            time: Date.now()
        });
        alert("Request sent!");
    }

    function loadAdminData() {
        db.collection('requests').where('status', '==', 'pending').onSnapshot(snap => {
            let html = "";
            snap.forEach(doc => {
                let r = doc.data();
                html += `<div style="padding:10px; border-bottom:1px solid #333;">
                    ${r.email} - ${r.type}: ₹${r.amount}
                    <button onclick="approve('${doc.id}', '${r.uid}', ${r.amount}, '${r.type}')">Approve</button>
                </div>`;
            });
            document.getElementById('adminRequests').innerHTML = html || "No requests.";
        });
    }

    async function approve(rid, uid, amt, type) {
        const userRef = db.collection('users').doc(uid);
        const snap = await userRef.get();
        let newBal = type === 'Deposit' ? (snap.data().balance + amt) : (snap.data().balance - amt);
        await userRef.update({ balance: newBal });
        await db.collection('requests').doc(rid).update({ status: 'approved' });
    }
</script>
</body>
</html>
