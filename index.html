<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkyWallet PRO - Investment</title>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #0b0f19; --glass: rgba(255, 255, 255, 0.05);
            --primary: #4f46e5; --accent: #22d3ee; --danger: #f43f5e; --text: #f8fafc;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; }
        .hidden { display: none !important; }

        /* Premium Login */
        #loginSection {
            height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: radial-gradient(circle at top right, #1e1b4b, #0b0f19); text-align: center; padding: 20px;
        }
        .logo-box { font-size: 3.5rem; font-weight: 900; background: linear-gradient(to bottom, #fff, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .tagline { font-size: 1.1rem; color: #94a3b8; margin: 5px 0 40px; font-weight: 300; }
        .login-card { background: var(--glass); backdrop-filter: blur(20px); padding: 40px 20px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 350px; }
        
        /* Dashboard UI */
        .container { max-width: 480px; margin: auto; padding: 15px; }
        .wallet-card { background: linear-gradient(135deg, #4f46e5, #9333ea); padding: 30px 20px; border-radius: 25px; text-align: center; box-shadow: 0 10px 30px rgba(79, 70, 229, 0.4); margin-top: 15px; }
        .card { background: var(--glass); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.08); margin-top: 20px; }
        
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; font-size: 1rem; }
        .btn-google { background: white; color: black; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn:active { transform: scale(0.97); }

        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.2); color: white; margin-bottom: 5px; }
        .history-item { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; font-size: 0.9rem; }
        .admin-req { background: rgba(244, 63, 94, 0.05); border: 1px solid rgba(244, 63, 94, 0.2); padding: 15px; border-radius: 15px; margin-top: 15px; }
    </style>
</head>
<body>

<div id="loginSection">
    <h1 class="logo-box">SkyWallet</h1>
    <p class="tagline">Apne paiso ko kaam par lagaye</p>
    <div class="login-card">
        <p style="margin-bottom:25px; opacity:0.8; font-size:0.9rem;">Surakshit investment ki shuruat karein</p>
        <button class="btn btn-google" onclick="login()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/pwa_google_symbol.svg" width="22">
            Google se Login karein
        </button>
    </div>
</div>

<div id="appSection" class="container hidden">
    <div style="display:flex; justify-content:space-between; align-items:center; padding:10px 0;">
        <h3 id="uName" style="margin:0">User</h3>
        <button onclick="logout()" style="background:none; border:none; color:var(--danger); font-weight:bold; cursor:pointer;">Logout</button>
    </div>

    <div class="wallet-card">
        <p style="font-size:0.8rem; opacity:0.8; letter-spacing:1px; margin:0;">TOTAL BALANCE</p>
        <h1 id="balanceDisplay" style="font-size:2.8rem; margin:10px 0;">₹0</h1>
    </div>

    <div class="card">
        <h4 style="margin:0 0 15px;">Add/Withdraw Funds</h4>
        <input type="number" id="amount" placeholder="Amount (₹) daalein">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button class="btn btn-primary" onclick="reqTx('Deposit')">Deposit</button>
            <button class="btn btn-primary" style="background:#334155" onclick="reqTx('Withdraw')">Withdraw</button>
        </div>
    </div>

    <div class="card">
        <h4 style="margin:0 0 10px;">Transaction History</h4>
        <div id="history">Loading...</div>
    </div>

    <div id="adminPanel" class="card hidden" style="border-color: var(--danger);">
        <h4 style="color:var(--danger); margin:0;">Admin Dashboard</h4>
        <div id="adminRequests">Loading...</div>
    </div>
</div>

<script>
    const firebaseConfig={
        apiKey:"AIzaSyB08YgLPpftxwvlKQQ9D4dRCEn4QXk-fks",
        authDomain:"investamount-2d60a.firebaseapp.com",
        projectId:"investamount-2d60a",
        storageBucket:"investamount-2d60a.firebasestorage.app",
        messagingSenderId:"1680550862",
        appId:"1:1680550862:web:5218a3fc4c1ba814cc599f"
    };

    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth();
    const db=firebase.firestore();
    const adminEmail="onlinetechcenter786@gmail.com";

    function login(){
        const provider=new firebase.auth.GoogleAuthProvider();
        auth.signInWithRedirect(provider);
    }
    function logout(){ auth.signOut().then(()=>location.reload()); }

    auth.onAuthStateChanged(user=>{
        if(user){
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("appSection").classList.remove("hidden");
            document.getElementById("uName").innerText="Namaste, "+user.displayName.split(" ")[0];

            db.collection("users").doc(user.uid).onSnapshot(doc=>{
                if(!doc.exists()){
                    db.collection("users").doc(user.uid).set({balance:0, email:user.email});
                } else {
                    document.getElementById("balanceDisplay").innerText="₹"+(doc.data().balance||0).toLocaleString();
                }
            });

            loadHistory(user.uid);
            if(user.email.toLowerCase()===adminEmail.toLowerCase()){
                document.getElementById("adminPanel").classList.remove("hidden");
                loadAdmin();
            }
        } else {
            document.getElementById("loginSection").classList.remove("hidden");
            document.getElementById("appSection").classList.add("hidden");
        }
    });

    async function reqTx(type){
        let amt=parseInt(document.getElementById("amount").value);
        if(!amt || amt<=0) return alert("Sahi amount daalein!");

        let pending = await db.collection("requests").where("uid","==",auth.currentUser.uid).where("status","==","pending").get();
        if(!pending.empty) return alert("Pehle se ek request pending hai!");

        await db.collection("requests").add({
            uid:auth.currentUser.uid, email:auth.currentUser.email,
            amount:amt, type:type, status:"pending", time:Date.now()
        });
        document.getElementById("amount").value="";
        alert("Request bhej di gayi!");
    }

    function loadHistory(uid){
        db.collection("requests").where("uid","==",uid).orderBy("time","desc").onSnapshot(snap=>{
            let html="";
            snap.forEach(doc=>{
                let r=doc.data();
                let color = r.status === 'approved' ? '#10b981' : (r.status === 'rejected' ? '#f43f5e' : '#94a3b8');
                html+=`<div class="history-item">
                    <span>${r.type} ₹${r.amount}</span>
                    <span style="color:${color}; font-weight:bold;">${r.status.toUpperCase()}</span>
                </div>`;
            });
            document.getElementById("history").innerHTML=html||"No history found.";
        });
    }

    function loadAdmin(){
        db.collection("requests").where("status","==","pending").onSnapshot(snap=>{
            let html="";
            snap.forEach(doc=>{
                let r=doc.data();
                html+=`<div class="admin-req">
                    <b>${r.email}</b><br>${r.type}: ₹${r.amount.toLocaleString()}<br>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button class='btn btn-primary' style="margin:0" onclick="approve('${doc.id}','${r.uid}',${r.amount},'${r.type}')">Approve</button>
                        <button class='btn btn-danger' style="margin:0" onclick="reject('${doc.id}')">Reject</button>
                    </div>
                </div>`;
            });
            document.getElementById("adminRequests").innerHTML=html||"No pending requests.";
        });
    }

    async function approve(id,uid,amt,type){
        const uRef=db.collection("users").doc(uid);
        const doc=await uRef.get();
        let bal=doc.data().balance||0;

        if(type==="Withdraw" && amt>bal) return alert("Balance kam hai!");

        let newBal=(type==="Deposit")?bal+amt:bal-amt;
        await uRef.update({balance:newBal});
        await db.collection("requests").doc(id).update({status:"approved"});
    }

    async function reject(id){
        await db.collection("requests").doc(id).update({status:"rejected"});
    }
</script>
</body>
</html>
